# FuckPortal — 非规则下界传送门插件（说明文档）

本插件扩展了原版传送门的建造方式：允许玩家在单一竖直平面内使用任意闭合黑曜石和哭泣黑曜石边界（非矩形、凹多边形等）生成下界传送门面。使用简单，支持配置最大大小。

## 快速开始

1. 构建插件 JAR：
   - 在项目根目录运行：
     - Windows: `gradlew.bat build`
     - Linux/macOS: `./gradlew build`
   - 构建产物位于 `build/libs/`（请将生成的 JAR 放入你的服务器 `plugins/` 目录）。

2. 第一次启动服务器或插件时：
   - 插件会在其数据目录生成 `config.yml`（若不存在）。
   - 你也可以手动编辑 `src/main/resources/config.yml` 并重建，或直接编辑服务器上的 `plugins/FuckPortal/config.yml`。

## 如何使用

- 在世界中，使用黑曜石和哭泣黑曜石围出任意闭合图形，图形必须处于同一个竖直平面内（两种可能平面：X固定的 Y-Z 平面或 Z固定的 Y-X 平面）。
- 图形内部应为空气（或已有传送门方块/火）。
- 使用打火石（法兰石，flint-and-steel）对“要点燃”的位置进行右键点火（可右键内层任意一个空格或对着边界点击导致相邻空气点燃）。
  - 插件会尝试在两个可能的平面（朝向 X 或朝向 Z）做二维洪水填充验证边界是否全部为黑曜石和哭泣黑曜石。
  - 若验证通过，插件会取消默认点火行为并将内部所有合法格子替换为传送门（NETHER_PORTAL）。
  - 若验证不通过，则交还原版点火行为（即点燃火）。

注意：若其它插件阻止了原版交互或点火事件，可能需要调整事件优先级或检查服务端配置。

## 配置（config.yml）

配置文件位置：
- 开发时：`src/main/resources/config.yml`
- 运行时：`plugins/FuckPortal/config.yml`

可用配置项：

- max-portal-size: `int`（默认 2048）
  - 单个非规则门内部允许的最大方块数。当洪水填充面积超过该值时视为无效（不会生成门）。
  - 最小允许值为 `1`（也就是允许只有一个方块的洞）。
- flood-per-tick: `int`（默认 256）
  - 数值越小越平滑，占用主线程时间更短但完成更慢；数值越大完成更快但可能产生瞬时卡顿。
  - 建议范围 64-512，默认 256

示例：
max-portal-size: 2048

修改配置后重载插件或重启服务器以生效（使用 `/reload` 视服务端插件架构和其他插件安全性而定，推荐重启服务器）。

## 实现细节（供运维/开发参考）

- 监听事件：
  - BlockIgniteEvent（点火）
  - PlayerInteractEvent（手持打火石右键交互）——避免被某些环境/服务端阻止时无法触发。
- 填充规则：
  - 可填充方块：AIR、FIRE、NETHER_PORTAL。
  - 合法边界方块：OBSIDIAN、CRYING_OBSIDIAN（黑曜石和哭泣黑曜石）。
  - 填充仅在单一固定坐标轴平面内进行（Y 与 X/Z 平面）。
  - 使用 BFS（洪水填充）遍历，遍历上限由配置 `max-portal-size` 控制，防止滥用或卡顿。
- 传送门朝向：
  - 插件会自动选择在两个方向中更符合玩家意图的方向（若两方向都有效则选更小的内域）。
  - 已知实现中对 Bukkit 的 BlockData 的 Axis 设置有过一次反向调整（已在代码中修正），如果遇到朝向问题可反馈或自行修改 `IrregularPortalModule.placePortal` 中的轴映射逻辑。

## 常见问题（FAQ）

Q: 我对着黑曜石和哭泣黑曜石点火没有反应？
- 确认你点的是“内部要点燃的位置”或右键朝向内部空格点火。插件同时监听了直接点燃（BlockIgniteEvent）和玩家交互（手持打火石右键），所以常规右键点火应能触发。
- 检查服务器控制台是否加载了插件（`fuckportal 加载完毕` 的日志）。若没有，确认 JAR 已放入 `plugins/` 并且服务端版本与 Spigot API 兼容（本项目使用 1.20 API 作为编译目标）。
- 检查是否其它插件拦截了交互事件或点火事件（例如防护/世界管理插件）。你可能需要提升事件优先级或调整插件顺序/配置。
- 确认黑曜石和哭泣黑曜石边界是完全闭合的，并且围绕内部没有其他非黑曜石和哭泣黑曜石方块直接作为边界。

Q: 门的朝向不对 / 门变成竖直但面向相反？
- 插件中对 Axis 的设置有映射（Axis.X <-> Axis.Z）以与 Bukkit 的 BlockData 要求匹配。如果你依然遇到朝向问题，可在 `IrregularPortalModule.placePortal` 中调整映射实现，或报告具体的坐标与形状以便诊断。

Q: 我想允许更大的门怎么办？
- 编辑 `plugins/FuckPortal/config.yml` 中的 `max-portal-size`，增大数值（注意服务器性能与现实可操作性）。
- 修改后重启服务器以使配置生效。

## 调试建议

- 在开发环境用小尺寸闭合形状先行测试（如内部 3×3、非矩形的“环”形），观察服务端日志。
- 若无日志输出，确认插件是否被正确加载（查看 `plugins/` 下的文件夹和控制台加载日志）。
- 若事件未触发，临时降低或移除可能拦截交互的插件来排查冲突。

## 许可与贡献

本项目基于你当前源码仓库结构直接实现。如需改进（例如支持水平面、不同边界方块、更多兼容性处理等），欢迎提 issue 或直接发起 PR。

---  
作者：cxkcxkckx
